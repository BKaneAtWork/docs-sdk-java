= Field Level Encryption
:page-topic-type: concept
:page-edition: Enterprise Edition
:page-aliases: ROOT:encryption.adoc
:page-status: Developer Preview
include::project-docs:partial$attributes.adoc[]

[abstract]
Fields within a document can be securely encrypted by the SDK, to support FIPS 140-2 compliance.


CAUTION: This is a developer preview release of Field Level Encryption for the 3.0 API version of Couchbase Java SDK.
As such, it is unsupported, and this documentation may lag behind development changes.
Refer to the https://github.com/couchbase/java-couchbase-encryption[GitHub repo^] for the latest updates.

[#architecture]
== Overview

.Actors & Responsibilities in Field Level Encryption
[#field_level_encryption--architecture]
image::{incimagesdir}/field_level_encryption-architecture.png[]

This is a client-side implementation, with key management and initialization of data encryption done during configuration of the SDK, which then exposes the API during runtime, for normal read/write operations.

[#algorithm]
== Algorithm and Key Store

From Couchbase Server 5.5, AES-256, AES-128, and RSA were all supported in earlier versions of the SDK's Field Level Encryption library -- these encryption algorithms are now deprecated, but decryption of data encrypted under earlier versions continues to be supported.
SDK 3 uses a new algorithm, AEAD_AES_256_CBC_HMAC_SHA_512, which bundles the auth key and the encryption key into a single 64-byte "fat key".
The key materials used by the AES and HMAC algorithms are distinct, but the keys can be managed as a single unit.

Native Keystores (including Java Key Store and Windows Certificate Store) are supported, as well as an in-memory keystore for development and testing.
More options for key stores and encryption algorithms may appear in future SDK releases.

[#format]
== Field Encryption Format

Hereâ€™s a document that illustrates how an encrypted field is stored in Couchbase.
The document has a normal field called "foo", and an encrypted field called "bar".
Note that the name of the "bar" field is mangled to indicate it holds an encrypted value:

----
{
  "foo": "I am not a secret",
  "encrypted$bar": {
    "alg": "AEAD_AES_256_CBC_HMAC_SHA512",
    "kid": "my-secret-key-name",
    "ciphertext": "<base64-encoded-ciphertext>"
  }
}
----

See the xref:howtos:encrypting-using-sdk.adoc[sample code page] for examples of reading & writing encrypted fields.

[#error]
== Data Safeguards

To prevent data loss under error conditions, an error in decryption or encryption in any part of an operation will cause the whole operation to fail with an exception.

[#packaging]
== Packaging

Field Level Encryption for all SDKs is a separate package from the Couchbase SDK itself; the APIs are extensions of the SDK, but the SDK does not have a dependency on FLE.
This means you can install the relevant SDK without being dependant upon a suite of crypto libraries.

[#fips-140-2]
== FIPS 140-2

The standard AEAD_AES_256_CBC_HMAC_SHA512 encryption algorithm is composed of FIPS 140-2 "Approved Security Functions."
